#!/bin/bash
set -e

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤..."

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥–∏–≤–∏–¥–µ–Ω–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
echo "üìä –ó–∞–ø—É—Å–∫ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤..."
npm run filter-dividends
if [ $? -eq 0 ]; then
  echo "‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
else
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤"
  exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Yahoo Finance
echo "üìà –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å Yahoo Finance..."
npm run scrape-yahoo
if [ $? -eq 0 ]; then
  echo "‚úÖ –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Yahoo Finance —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω"
else
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö —Å Yahoo Finance"
  exit 1
fi

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Telegram
echo "üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Telegram..."
# –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º TypeScript –≤ JavaScript –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
npx tsc send-to-telegram.ts --esModuleInterop --resolveJsonModule
node send-to-telegram.js
if [ $? -eq 0 ]; then
  echo "‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram"
else
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram"
  exit 1
fi

echo "üéâ –í—Å–µ –∑–∞–¥–∞—á–∏ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!" 